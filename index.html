<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡Œç¨‹è®¡åˆ’</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- ç™»å½•å¼¹çª—ï¼ˆå¿…é¡»åœ¨ main-content å¤–é¢ï¼‰ -->
    <div id="login-modal" class="modal" style="display: flex;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ç”¨æˆ·ç™»å½•</h3>
            </div>
            <div class="modal-body">
                <div class="login-form">
                    <div class="form-group">
                        <label for="login-username">ç”¨æˆ·åï¼š</label>
                        <input type="text" id="login-username" class="form-input" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label for="login-password">å¯†ç ï¼š</label>
                        <input type="password" id="login-password" class="form-input" placeholder="è¯·è¾“å…¥å¯†ç " autocomplete="current-password">
                    </div>
                    <button class="btn-login" id="login-btn" type="button">ç™»å½•</button>
                </div>
            </div>
        </div>
    </div>

    <div class="main-container" id="main-content" style="display: none;">
        <!-- å·²ç™»å½•ç”¨æˆ·æ˜¾ç¤ºå’Œæ•°æ®åŒæ­¥ï¼ˆåˆå¹¶ï¼‰ -->
        <div id="user-logged-in" class="user-sync-container" style="display: none;">
            <div class="user-sync-header">
                <div class="user-info">
                    <span class="user-label">å½“å‰ç”¨æˆ·ï¼š</span>
                    <span id="logged-in-user-name" class="user-name"></span>
                    <span id="sync-status" class="sync-status"></span>
                </div>
                <div class="sync-buttons-top">
                    <button class="sync-btn sync-btn-upload" onclick="syncUpload()" title="æ‰‹åŠ¨ä¸Šä¼ åˆ°äº‘ç«¯">â†‘</button>
                    <button class="sync-btn sync-btn-download" onclick="syncDownload()" title="ä»äº‘ç«¯ä¸‹è½½">â†“</button>
                    <button class="btn-logout" onclick="handleLogout()" title="é€€å‡ºç™»å½•">Ã—</button>
                </div>
            </div>
        </div>

        <!-- æ–°å¢è¡Œç¨‹é¡¹æ¨¡æ€æ¡† -->
        <div id="add-item-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>æ–°å¢è¡Œç¨‹é¡¹</h3>
                    <button class="modal-close" onclick="closeAddItemModal()">Ã—</button>
                </div>
                <div class="modal-body">
                    <div class="config-section">
                        <label for="new-item-category">äº‹é¡¹åç§° *</label>
                        <input type="text" id="new-item-category" placeholder="ä¾‹å¦‚ï¼šæ—©é¤ã€æ™¯ç‚¹æ¸¸è§ˆç­‰" required>
                    </div>
                    <div class="config-section">
                        <label for="new-item-time">æ—¶é—´</label>
                        <input type="text" id="new-item-time" placeholder="ä¾‹å¦‚ï¼š08:00-10:00">
                    </div>
                    <div class="config-section">
                        <label for="new-item-plan">è®¡åˆ’</label>
                        <textarea id="new-item-plan" rows="3" placeholder="è¾“å…¥è®¡åˆ’å†…å®¹..."></textarea>
                    </div>
                    <div class="config-section">
                        <label for="new-item-note">å¤‡æ³¨</label>
                        <textarea id="new-item-note" rows="3" placeholder="è¾“å…¥å¤‡æ³¨ä¿¡æ¯..."></textarea>
                    </div>
                    <div class="config-section">
                        <label for="new-item-tag">åˆ†ç±»æ ‡ç­¾</label>
                        <select id="new-item-tag">
                            <option value="å…¶ä»–">ğŸ“‹ å…¶ä»–</option>
                            <option value="æ™¯ç‚¹">ğŸ›ï¸ æ™¯ç‚¹</option>
                            <option value="ç¾é£Ÿ">ğŸœ ç¾é£Ÿ</option>
                            <option value="ä½å®¿">ğŸ¨ ä½å®¿</option>
                            <option value="èµ¶è·¯">ğŸš— èµ¶è·¯</option>
                        </select>
                    </div>
                    <div class="config-actions">
                        <button class="btn-primary" onclick="saveNewItem()">ä¿å­˜</button>
                        <button class="btn-secondary" onclick="closeAddItemModal()">å–æ¶ˆ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- åˆå§‹åŒ–å¯†ç æ¨¡æ€æ¡† -->
        <div id="init-password-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>åˆå§‹åŒ–ç”¨æˆ·å¯†ç </h3>
                    <button class="modal-close" onclick="closeInitPasswordModal()">Ã—</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="init-mrb-password">mrbå¯†ç ï¼š</label>
                        <input type="password" id="init-mrb-password" class="form-input" placeholder="è®¾ç½®mrbçš„å¯†ç ">
                    </div>
                    <div class="form-group">
                        <label for="init-djy-password">djyå¯†ç ï¼š</label>
                        <input type="password" id="init-djy-password" class="form-input" placeholder="è®¾ç½®djyçš„å¯†ç ">
                    </div>
                    <small style="color: #666; display: block; margin-top: 10px;">âš ï¸ å¯†ç å°†å­˜å‚¨åœ¨Firebaseä¸­ï¼Œè¯·å¦¥å–„ä¿ç®¡ã€‚å¿˜è®°å¯†ç éœ€è¦é‡æ–°åˆå§‹åŒ–ã€‚</small>
                    <div class="config-actions" style="margin-top: 20px;">
                        <button class="btn-primary" onclick="initPasswords()">ä¿å­˜å¯†ç </button>
                        <button class="btn-secondary" onclick="closeInitPasswordModal()">å–æ¶ˆ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- åŒæ­¥é…ç½®æ¨¡æ€æ¡† -->
        <div id="sync-config-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>åŒæ­¥é…ç½®</h3>
                    <button class="modal-close" onclick="closeSyncConfig()">Ã—</button>
                </div>
                <div class="modal-body">
                    <!-- Firebase é…ç½® -->
                    <div id="firebase-config" class="sync-config-panel">
                        <div class="config-section">
                            <label for="firebase-api-key">API Keyï¼š</label>
                            <input type="text" id="firebase-api-key" placeholder="AIza...">
                        </div>
                        <div class="config-section">
                            <label for="firebase-auth-domain">Auth Domainï¼š</label>
                            <input type="text" id="firebase-auth-domain" placeholder="your-project.firebaseapp.com">
                        </div>
                        <div class="config-section">
                            <label for="firebase-database-url">Database URLï¼š</label>
                            <input type="text" id="firebase-database-url" placeholder="https://your-project.firebaseio.com">
                        </div>
                        <div class="config-section">
                            <label for="firebase-project-id">Project IDï¼š</label>
                            <input type="text" id="firebase-project-id" placeholder="your-project-id">
                        </div>
                        <div class="config-section">
                            <label for="firebase-database-path">Database Pathï¼ˆå¯é€‰ï¼‰ï¼š</label>
                            <input type="text" id="firebase-database-path" placeholder="trip_plan_data" value="trip_plan_data">
                            <small>æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤ï¼štrip_plan_data</small>
                        </div>
                        <div class="config-section">
                            <small>âš ï¸ æ³¨æ„ï¼šä½¿ç”¨Firebaseéœ€è¦å…ˆå¼•å…¥Firebase SDKã€‚åœ¨index.htmlä¸­æ·»åŠ ï¼š<br>
                            &lt;script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"&gt;&lt;/script&gt;<br>
                            &lt;script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"&gt;&lt;/script&gt;</small>
                        </div>
                    </div>
                    
                    <div class="config-section">
                        <label>
                            <input type="checkbox" id="auto-sync-checkbox">
                            å¯ç”¨è‡ªåŠ¨åŒæ­¥
                            <span id="auto-sync-desc">ï¼ˆæ¯30ç§’è‡ªåŠ¨ä¸Šä¼ ï¼‰</span>
                        </label>
                    </div>
                    <div class="config-actions">
                        <button class="btn-primary" onclick="saveSyncConfig()">ä¿å­˜é…ç½®</button>
                        <button class="btn-secondary" onclick="closeSyncConfig()">å–æ¶ˆ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ ‡é¢˜åŒºåŸŸ -->
        <div class="header">
            <h1>æµ™ä¸œè¡Œç¨‹è®¡åˆ’ï¼ˆä¸Šæµ·â†’ç»å…´â†’è¡¢å·â†’ä¹‰ä¹Œâ†’ä¸Šæµ·ï¼‰</h1>
        </div>

        <!-- ç›®å½•å¯¼èˆª -->
        <div class="nav-container">
            <h2>è¡Œç¨‹æ€»è§ˆ</h2>
            <ul class="nav-list">
                <!-- å¯¼èˆªé¡¹å°†ç”± JavaScript åŠ¨æ€ç”Ÿæˆ -->
            </ul>
        </div>

        <!-- ç­›é€‰é¢æ¿ -->
        <div id="filter-panel" class="filter-panel" style="display: none;">
            <div class="filter-buttons">
                <button class="filter-tag-btn" onclick="setFilter('all')">å…¨éƒ¨</button>
                <button class="filter-tag-btn" onclick="setFilter('æ™¯ç‚¹')">ğŸ›ï¸ æ™¯ç‚¹</button>
                <button class="filter-tag-btn" onclick="setFilter('ç¾é£Ÿ')">ğŸœ ç¾é£Ÿ</button>
                <button class="filter-tag-btn" onclick="setFilter('ä½å®¿')">ğŸ¨ ä½å®¿</button>
                <button class="filter-tag-btn" onclick="setFilter('èµ¶è·¯')">ğŸš— èµ¶è·¯</button>
                <button class="filter-tag-btn" onclick="setFilter('å…¶ä»–')">ğŸ“‹ å…¶ä»–</button>
            </div>
        </div>

        <!-- æ—¥æœŸæ ‡é¢˜ -->
        <div class="day-header">
            <h2>Day 1: ä¸Šæµ· â†’ ç»å…´ï¼ˆä¸å˜ï¼‰</h2>
        </div>

        <!-- å¡ç‰‡å®¹å™¨ -->
        <div id="cards-container" class="cards-container">
            <div class="card-indicator"></div>
        </div>
    </div>

    <!-- æ•°æ®ä»æ•°æ®åº“æˆ–ç¼“å­˜åŠ è½½ï¼Œä¸å†ä½¿ç”¨data.js -->
    <!-- å¼•å…¥ç»Ÿä¸€æ•°æ®ç»“æ„å·¥å…· -->
    <script src="trip-data-structure.js"></script>
    <!-- ä¸å†ä»config.jså¯¼å…¥tokenï¼Œtokenç¼“å­˜åœ¨localStorageä¸­ -->
    <!-- Firebase SDK (å¦‚æœä½¿ç”¨FirebaseåŒæ­¥) -->
    <script type="module">
        // å¯¼å…¥ Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getDatabase } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";
        
        // Firebase é…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyD1ibXnpROs_28gzzfBIPzvwvNYj13gSOM",
            authDomain: "trip-plan-cetus.firebaseapp.com",
            databaseURL: "https://trip-plan-cetus-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "trip-plan-cetus",
            storageBucket: "trip-plan-cetus.firebasestorage.app",
            messagingSenderId: "593052021342",
            appId: "1:593052021342:web:951da391daaed3a0f67acf",
            measurementId: "G-WVNF8DL6QD"
        };
        
        // åˆå§‹åŒ– Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        // å°† Firebase å®ä¾‹æš´éœ²åˆ°å…¨å±€ï¼Œä¾› sync-firebase.js ä½¿ç”¨
        window.firebaseApp = app;
        window.firebaseDatabase = database;
        window.firebaseConfig = firebaseConfig;
        
        // æ ‡è®° Firebase å·²åŠ è½½
        window.firebaseLoaded = true;
        
        // è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œé€šçŸ¥ Firebase å·²åŠ è½½
        window.dispatchEvent(new CustomEvent('firebaseReady'));
    </script>
    <!-- Cloudinary Upload Widget SDK -->
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
    <!-- å¼•å…¥åŒæ­¥åŠŸèƒ½ -->
    <!-- åªä½¿ç”¨FirebaseåŒæ­¥ï¼Œä¸å†ä½¿ç”¨Gist -->
    <script src="sync-firebase.js"></script>
    <!-- å¼•å…¥é€»è¾‘æ–‡ä»¶ -->
    <script src="script.js"></script>
</body>
</html>

